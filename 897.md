1. В составе заказа товары с акциями 1 и 3:
Для товаров с типом акции 3 или без акции рассчитать стоимость доставки (не применяя акцию)
Для товаров с типом акции 1 рассчитать стоимость = значению поля Акционная стоимость
Просуммировать полученные стоимости на шаге 1 и 3
Отнять от суммарной стоимости доставки значение поля Акционная стоимость для типа акции = 3

2. В составе заказа товары с акциями 2 и 3:
Определяем стоимость доставки товаров, применяя акцию только типа акции "2".
Определить стоимость доставки не акционных товаров (вес всех товаров - вес товаров типа 2);
Определить стоимость доставки товаров с учетом акции: стоимость доставки заказа с учетом акционноготовара - значение акции (вес всех товаров->стоимость доставки - значение акции)
Выбрать большую стоимость из шага 1 и 2
К найденной стоимости применить значение акции типа "3"

3. В составе заказа товары с акциями 1, 2 и 3:
Определяем стоимость доставки товаров с учетом типа акции "2" (при этом товар с акцией типом 1 в расчетах не принимает участия)
К найденной стоимости добавить значение акции типа 1
От найденной стоимость доставки отнять значение акции тип "3"
Не забыть про проверки:
